# Century 21 Smart CRM - 백엔드 연동 및 추가 개발 가이드

## 1. MVP 현재 상태

### 1.1 데이터 저장 방식
| 항목 | 현재 상태 | 실서비스 필요 |
|------|----------|--------------|
| 고객 데이터 | React State (메모리) | Database (Supabase/PostgreSQL 등) |
| 파일 첨부 | Base64 (메모리) | Object Storage (S3/Supabase Storage) |
| 사진 | Base64 (메모리) | Object Storage |
| 인증 | 없음 | Auth 서비스 (Supabase Auth/Firebase) |

### 1.2 새로고침 시 동작
- ⚠️ **모든 데이터 초기화** (초기 Mock Data로 리셋)
- 실서비스에서는 DB 연동 필수

---

## 2. 백엔드 연동 필요 항목

### 2.1 우선순위 High

#### 2.1.1 사용자 인증
| 항목 | 설명 | 예상 공수 |
|------|------|----------|
| 로그인/로그아웃 | 이메일+비밀번호 또는 소셜 로그인 | 2-3일 |
| 회원가입 | 에이전트 등록 신청 | 1-2일 |
| 비밀번호 재설정 | 이메일 인증 | 1일 |
| 세션 관리 | JWT 토큰 처리 | 1일 |

**추천 솔루션**: Supabase Auth, Firebase Auth, Auth0

#### 2.1.2 데이터베이스 연동
| 항목 | 설명 | 예상 공수 |
|------|------|----------|
| 고객 CRUD | 생성/조회/수정/삭제 | 3-4일 |
| Contact 기록 | 연락 이력 저장 | 1-2일 |
| 일정 관리 | 일정 CRUD | 1-2일 |
| 그룹/목표 | 그룹, 목표 데이터 | 1-2일 |

**추천 솔루션**: Supabase (PostgreSQL), PlanetScale (MySQL)

### 2.2 우선순위 Medium

#### 2.2.1 파일 저장소
| 항목 | 설명 | 예상 공수 |
|------|------|----------|
| 프로필 사진 업로드 | 이미지 리사이징 포함 | 2일 |
| 첨부파일 업로드 | 파일 타입 검증 | 2일 |
| 파일 다운로드 | 서명된 URL 생성 | 1일 |

**추천 솔루션**: Supabase Storage, AWS S3, Cloudflare R2

#### 2.2.2 알림 서비스
| 항목 | 설명 | 예상 공수 |
|------|------|----------|
| 웹 푸시 알림 | FCM 웹 푸시 | 3-4일 |
| 모바일 푸시 | FCM/APNs (앱 필요) | 5-7일 |
| 이메일 알림 | Contact 기한 알림 | 2-3일 |

### 2.3 우선순위 Low

#### 2.3.1 외부 서비스 연동
| 항목 | 설명 | 예상 공수 | 비용 |
|------|------|----------|------|
| SMS 발송 | 대량 문자 발송 | 3-4일 | 건당 10-20원 |
| 이메일 발송 | 대량 메일 발송 | 2-3일 | 월 구독 또는 건당 |
| 카카오 알림톡 | 알림톡 발송 | 4-5일 | 건당 8-15원 |
| AI 연동 | Gemini API 실제 연결 | 2-3일 | API 호출당 과금 |

---

## 3. 예상 공수 산정

### 3.1 Phase별 개발 공수

| Phase | 항목 | 예상 기간 | 필요 인력 |
|-------|------|----------|----------|
| **Phase A** | 인증 + DB 기본 연동 | 2-3주 | 백엔드 1명 |
| **Phase B** | 파일 저장소 + 알림 | 2주 | 백엔드 1명 |
| **Phase C** | SMS/이메일 연동 | 1-2주 | 백엔드 1명 |
| **Phase D** | 카카오톡 + AI | 2주 | 백엔드 1명 |

### 3.2 총 예상 기간
- **최소**: 7주 (빠른 진행 시)
- **권장**: 10-12주 (안정적 개발)
- **여유**: 16주 (테스트/QA 포함)

---

## 4. 비용 구조 (예상)

### 4.1 인프라 비용 (월간)

| 항목 | 서비스 | 예상 비용 | 비고 |
|------|--------|----------|------|
| 호스팅 | Vercel Pro | $20/월 | 현재 무료 사용 중 |
| 데이터베이스 | Supabase Pro | $25/월 | Free tier: 500MB |
| 파일 저장소 | Supabase Storage | $25/월 포함 | 1GB 기본 |
| 합계 | - | **$45-70/월** | 초기 기준 |

### 4.2 서비스 비용 (사용량 기반)

| 항목 | 단가 | 월 1,000건 기준 |
|------|------|----------------|
| SMS | 15원/건 | 15,000원 |
| 알림톡 | 10원/건 | 10,000원 |
| 이메일 | 무료~0.1원/건 | 0-100원 |
| AI (Gemini) | $0.0005/1K토큰 | 5,000원 |

### 4.3 월간 총 비용 예상
- **최소 운영**: 5-7만원/월
- **일반 운영**: 10-15만원/월
- **대규모 사용**: 30만원+/월

---

## 5. 기술적 고려사항

### 5.1 데이터 마이그레이션
현재 Mock Data에서 실제 DB로 전환 시:
```
1. 데이터베이스 스키마 설계
2. API 엔드포인트 개발
3. AppContext를 API 호출로 교체
4. 초기 데이터 마이그레이션 스크립트
```

### 5.2 보안 고려사항
| 항목 | 현재 | 필요 조치 |
|------|------|----------|
| 인증 | 없음 | JWT/세션 기반 인증 |
| API 보안 | N/A | Rate Limiting, CORS |
| 데이터 암호화 | 없음 | 민감정보 암호화 |
| 파일 접근 | 없음 | 서명된 URL, 권한 검증 |

### 5.3 성능 최적화
| 항목 | 필요 시점 | 방법 |
|------|----------|------|
| 페이지네이션 | 고객 100명+ | 서버사이드 페이지네이션 |
| 이미지 최적화 | 즉시 | 업로드 시 리사이징, CDN |
| 캐싱 | 트래픽 증가 시 | Redis, SWR/React Query |

---

## 6. 추천 기술 스택 (백엔드)

### 6.1 Serverless 방식 (권장)
```
인증: Supabase Auth
데이터베이스: Supabase (PostgreSQL)
파일 저장: Supabase Storage
API: Supabase Edge Functions 또는 Next.js API Routes
호스팅: Vercel
```

**장점**: 
- 인프라 관리 최소화
- 자동 스케일링
- 비용 효율적 (소규모 시작)

### 6.2 Traditional 방식
```
인증: 자체 구현 또는 Auth0
데이터베이스: PostgreSQL (AWS RDS/Cloud SQL)
파일 저장: AWS S3
API: Node.js (Express/Nest.js)
호스팅: AWS EC2 또는 Cloud Run
```

**장점**:
- 완전한 제어
- 커스터마이징 자유도
- 대규모 확장 용이

---

## 7. 코드 수정 포인트

### 7.1 API 연동 시 수정 필요 파일

| 파일 | 현재 | 변경 내용 |
|------|------|----------|
| `context/AppContext.tsx` | Mock State | API 호출로 교체 |
| `views/CustomerDB.tsx` | 동기 처리 | 비동기 + 로딩 상태 |
| `views/CustomerDetail.tsx` | 동기 처리 | 비동기 + 로딩 상태 |
| `components/ExcelUploadModal.tsx` | 메모리 저장 | API 업로드 |
| `views/OperationalManagement.tsx` | 시뮬레이션 | 실제 API 호출 |

### 7.2 새로 필요한 파일

```
services/
├── api.ts              # API 클라이언트 설정
├── authService.ts      # 인증 관련
├── customerService.ts  # 고객 API
├── storageService.ts   # 파일 업로드
├── notificationService.ts  # 알림
└── messagingService.ts # SMS/이메일
```

---

## 8. 개발 순서 권장

```
1단계: 인프라 세팅 (1주)
├── Supabase 프로젝트 생성
├── 데이터베이스 스키마 설계
└── 환경 변수 설정

2단계: 인증 구현 (1-2주)
├── 로그인/회원가입 UI
├── 인증 상태 관리
└── 보호된 라우트

3단계: 핵심 API 연동 (2-3주)
├── 고객 CRUD API
├── Contact 기록 API
├── 일정/그룹/목표 API
└── AppContext → API 교체

4단계: 파일 업로드 (1주)
├── Storage 설정
├── 이미지 업로드
└── 첨부파일 업로드

5단계: 알림 서비스 (1-2주)
├── 이메일 알림
├── 웹 푸시 (선택)
└── Contact 기한 알림 자동화

6단계: 외부 연동 (2주+)
├── SMS API 연동
├── 카카오 알림톡 (선택)
└── AI 연동 (선택)
```
